pipeline {
    agent any

    stages{
        stage('clone and clean repos'){
            steps {
            	bat "cd .."
            	bat "rmdir /S /q Devops"
                bat "git clone -b master https://github.com/faffousa/DevopsSpring"
                bat "mvn clean install -U -f Devops"
            }
        }
        stage('Test'){
            steps{ bat "mvn test -f Devops"}
        }
        stage('Deploy'){
            steps {
                bat "mvn package -f Devops"
                bat "mvn deploy -f Devops"
                bat "mvn sonar:sonar -f Devops"
                //build image on docker
            }
        }
        //send email
        stage('Email'){
            steps{
                //extended email
                emailext body: 'New Commit! Deployed to Sonar Check it.', subject: 'Hey mahdi !', to: 'mehdi.hrairi@esprit.tn'
            }
        }
        //build image on docker
        stage('Build Docker Image') {

			steps {
				bat 'docker build -t mahdi0606/timesheet:latest .'
			}
		}
		/// stage('Build Docker Mysql Images') {

			///steps {
				///bat 'docker compose up'
			///}
		///}
	}
}